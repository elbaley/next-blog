+++
title= "Intersection Observer API"
description = ""
date= "2022-07-26T15:57:00+03:00"
author = "Furkan"
favorite = false
tags = [

]
categories = [
"Javascript"
]

draft= false
+++

## Problem

Javascript ile istenilen elemanÄ±n DOM Ã¼zerinde gÃ¶rÃ¼nÃ¼p gÃ¶rÃ¼nmediÄŸini takip etmek geÃ§miÅŸten beri zor bir iÅŸti. Bu iÅŸlem iÃ§in 'scroll' eventini dinleyip hedef elemanÄ±n DOM Ã¼zerindeki konumuna gÃ¶re aksiyon alÄ±yorduk. Ancak bu yaklaÅŸÄ±mda performans sorunlarÄ± ve istenmeyen davranÄ±ÅŸlar kaÃ§Ä±nÄ±lmaz oluyordu. Neyse ki web sitelerinin bu ihtiyaÃ§larÄ± geliÅŸtikÃ§e bu amaca yÃ¶nelik bir API geliÅŸtirildi.

![Deneme](/images/observer-ornek.webp)
Ã–rneÄŸin Element 2 ekranda gÃ¶rÃ¼nÃ¼r olduÄŸu anda sitemizin arka planÄ±nÄ± deÄŸiÅŸtirmek istiyorsak eskiden izlediÄŸimiz yol ÅŸu ÅŸekildeydi:

- Element 2'nin DOM'daki konumunu al.
- 'scroll' eventini izlemeye baÅŸla.
- Scroll konumundan Element 2'nin ekranda gÃ¶rÃ¼nÃ¼p gÃ¶rÃ¼nmediÄŸini hesapla.
- Element 2 gÃ¶rÃ¼ndÃ¼ÄŸÃ¼nde arka planÄ± deÄŸiÅŸtir.

Bu yaklaÅŸÄ±mda her bir pixellik harekette dahi fonksiyonumuz Ã§alÄ±ÅŸtÄ±ÄŸÄ±ndan performans sorunlarÄ± ile karÅŸÄ±laÅŸabiliriz bunun iÃ§in optimizasyonlar yapmak zorundayÄ±z.

## Ã‡Ã¶zÃ¼m

`Intersection Observer API` kullandÄ±ÄŸÄ±mÄ±zda izleyeceÄŸimiz yol ÅŸu hale gelir:

- Element 2'yi Intersection Observer ile izlemeye baÅŸla ve callback olarak arka planÄ± deÄŸiÅŸtirecek bir fonksiyon yaz.
- Element 2 gÃ¶rÃ¼ndÃ¼ÄŸÃ¼nde Intersection Observer arka planÄ± deÄŸiÅŸtirecektir.

## Ã–rnek

Åimdi daha anlaÅŸÄ±lÄ±r olmasÄ± iÃ§in yukarÄ±da resimle gÃ¶sterdiÄŸimiz senaryoyu koda dÃ¶kÃ¼p Intersection Observer API yardÄ±mÄ±yla istediÄŸimiz iÅŸlemi gerÃ§ekleÅŸtirmeye Ã§alÄ±ÅŸalÄ±m.

Ã–ncelikle HTML iskeletimizi oluÅŸturalÄ±m:

```html
<main>
  <div class="element1">ELEMENT 1</div>
  <div class="element2">ELEMENT 2</div>
</main>
```

SonrasÄ±nda elemanlarÄ±mÄ±zÄ± konumlandÄ±rmak ve gerekli arka plan renklerini vermek iÃ§in css tanÄ±mlarÄ±mÄ±zÄ± ekleyelim;

```css
body {
  background: white;
}
main {
  height: 100vh; /* ekranÄ±n tamamÄ±nÄ± kaplamasÄ± iÃ§in bu boyutu verelim */
}
.element1 {
  background: orange;
  height: 100vh;
  text-align: center;
  margin-bottom: 5rem;
}
.element2 {
  background: blue;
  text-align: center;
}
```

Buraya kadar ÅŸu ÅŸekilde bir sayfa elde ettik:
![ObserverOrnek1](/images/observer-ornek-1.gif)

Ã–ncelikle Intersection Observer constructor kullanarak bir instance yaratalÄ±m ve hedef elemanÄ±mÄ±zÄ± takip etmeye baÅŸlayalÄ±m.

```js
// KullanacaÄŸÄ±mÄ±z elemanlarÄ± tanÄ±mlayalÄ±m:
const bodyElement = document.querySelector("body");
const element1 = document.querySelector(".element1");
const element2 = document.querySelector(".element2");

// const observer = new IntersectionObserver(callbackFunction,options) (options parametresi Ã¶zel ayarlar belirtebileceÄŸimiz bir objedir, opsiyoneldir)

// bu callback fonksiyonu observe ettiÄŸimiz elementler ekranda
// gÃ¶zÃ¼kmeye baÅŸladÄ±ÄŸÄ±nda/kaybolduÄŸunda Ã§alÄ±ÅŸacak
// ÅŸimdilik sadece logluyoruz
function callbackFunction(entries) {
  entries.forEach((entry) => {
    console.log(entry);
    alert;
  });
}

// IntersectionObserver instance'Ä±mÄ±zÄ± oluÅŸturalÄ±m.
const observer = new IntersectionObserver(callbackFunction);

// element2'yi observe etmeye baÅŸlayalÄ±m:
observer.observe(element2);
```

SayfayÄ± tarayÄ±cÄ±mÄ±zdan aÃ§Ä±p element2'ye doÄŸru scroll ettikten sonra console'da ÅŸu ÅŸekilde bir entry objectinin loglandÄ±ÄŸÄ±nÄ± gÃ¶receksiniz:
![ObserverLog](/images/observer-console.webp)
Ã‡oÄŸu zaman iÃ§in en Ã§ok iÅŸimize yarayacak property'ler `intersectionRatio` ve `isIntersecting` olacaktÄ±r.

`isIntersecting` property'si eÄŸer hedef eleman root elemanda (varsayÄ±lan olarak viewport kullanÄ±lÄ±r) gÃ¶zÃ¼kÃ¼yorsa `true` gÃ¶zÃ¼kmÃ¼yorsa `false` dÃ¶ner.

`intersectionRatio` ise hedef elemanÄ±mÄ±zÄ±n ÅŸu an yÃ¼zde kaÃ§Ä±nÄ±n gÃ¶rÃ¼ndÃ¼ÄŸÃ¼nÃ¼ dÃ¶ner. (Ã–rneÄŸin tamamÄ± gÃ¶rÃ¼nÃ¼yorsa 1 , hiÃ§ gÃ¶zÃ¼kmÃ¼yorsa 0.)

Logu inceledikten sonra ÅŸimdi hedefimizi gerÃ§ekleÅŸtirmek iÃ§in callbackFunction'Ä±mÄ±zÄ± yazalÄ±m:

```js
function callbackFunction(entries) {
  entries.forEach((entry) => {
    if (entry.isIntersecting) {
      bodyElement.style.background = "red";
    } else {
      bodyElement.style.background = "white";
    }
  });
}
```

ArtÄ±k element2 gÃ¶rÃ¼ndÃ¼ÄŸÃ¼nde arka planÄ±mÄ±zÄ±n kÄ±rmÄ±zÄ±; gÃ¶rÃ¼nmediÄŸinde ise beyaz olduÄŸunu gÃ¶rebiliriz.
Ã–rneÄŸi aÅŸaÄŸÄ±da inceleyebilirsiniz:

<p class="codepen" data-height="300" data-default-tab="html,result" data-slug-hash="poLPbgb" data-user="elbaley" style="height: 300px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;">
  <span>See the Pen <a href="https://codepen.io/elbaley/pen/poLPbgb">
  Intersection Observer Demo</a> by Furkan (<a href="https://codepen.io/elbaley">@elbaley</a>)
  on <a href="https://codepen.io">CodePen</a>.</span>
</p>
<script async src="https://cpwebassets.codepen.io/assets/embed/ei.js"></script>

## Options

Intersection Observer constructor'Ä±na ekleyeceÄŸimiz options objecti ile callback fonksiyonumuzun Ã§alÄ±ÅŸacaÄŸÄ± durumlara ince ayar yapabiliriz. KullanabileceÄŸimiz seÃ§enekler ise ÅŸunlar:

`root`: ElemanÄ±mÄ±zÄ±n direkt olarak sayfada deÄŸil, baÅŸka bir elemanÄ±n iÃ§inde gÃ¶rÃ¼nÃ¼p gÃ¶rÃ¼nmediÄŸini kontrol etmek istediÄŸimizde burada hedef elemanÄ± belirtebiliriz. (Ã–rneÄŸin overflowu gizlenmiÅŸ ve kaydÄ±rabildiÄŸimiz bir divimiz var bu divi baz alarak gÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼ takip etmek istiyorsak bu divi burada belirtebiliriz.) VarsayÄ±lan olarak null olduÄŸundan tÃ¼m sayfa baz alÄ±nÄ±r.

`rootMargin`: CSS'deki margin deÄŸeri gibidir. Root nesnemize margin ekleyebiliriz. Bu parametreyi kullanmak iÃ§in root parametresinin atanmÄ±ÅŸ olmasÄ± gerekir.

`threshold` : Hedef elemanÄ±mÄ±zÄ±n yÃ¼zde kaÃ§Ä± gÃ¶rÃ¼ndÃ¼ÄŸÃ¼nde fonksiyonumuzun Ã§alÄ±ÅŸacaÄŸÄ±nÄ± belirler. VarsayÄ±lan deÄŸer 0 olduÄŸundan hedef elemanÄ±mÄ±zÄ±n 1pixeli gÃ¶zÃ¼kmeye baÅŸladÄ±ÄŸÄ± anda fonksiyonumuz deÄŸisir. Tek bir deÄŸer seÃ§ebildiÄŸimiz gibi bir array iÃ§erisinde birden fazla deÄŸer de belirleyebiliriz. (Ã–rneÄŸin `0.5` deÄŸerini girersek elemanÄ±mÄ±zÄ±n yarÄ±sÄ± gÃ¶zÃ¼ktÃ¼ÄŸÃ¼ anda fonksiyonumuz Ã§alÄ±ÅŸÄ±r. `[0.25,0.5]` arrayini atadÄ±ÄŸÄ±mÄ±zda ise fonksiyonumuz elemanÄ±mÄ±zÄ±n Ã¶nce %25i gÃ¶rÃ¼ndÃ¼ÄŸÃ¼nde sonra %50'si gÃ¶rÃ¼ndÃ¼ÄŸÃ¼nde Ã§alÄ±ÅŸÄ±r. )

### Options Demo

Ä°lk demoda mavi arkaplana sahip olan element 2'nin 1 pixeli ekranda gÃ¶rÃ¼nÃ¼r gÃ¶rÃ¼nmez arka plan rengimizi deÄŸiÅŸtiren fonksiyonumuz Ã§alÄ±ÅŸÄ±yor. Options objecti oluÅŸturup threshold deÄŸerini 1 yaparsak element 2'nin tamamÄ± gÃ¶rÃ¼nmeyene kadar arka planÄ±mÄ±z beyaz kalacaktÄ±r:

```js
const options = {
  threshold: 1,
};
const observer = new IntersectionObserver(callbackFunction, options);
```

<p class="codepen" data-height="300" data-default-tab="html,result" data-slug-hash="abYLqJM" data-user="elbaley" style="height: 300px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;">
  <span>See the Pen <a href="https://codepen.io/elbaley/pen/abYLqJM">
  Intersection Observer Demo 2 </a> by Furkan (<a href="https://codepen.io/elbaley">@elbaley</a>)
  on <a href="https://codepen.io">CodePen</a>.</span>
</p>
<script async src="https://cpwebassets.codepen.io/assets/embed/ei.js"></script>

### Referanslar

[ğŸ”— MDN Intersection Observer](https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API)

[ğŸ”— Understanding the Intersection Observer JavaScript API](https://medium.com/whatfix-techblog/understanding-the-intersection-observer-javascript-api-78661000c1f1)

[ğŸ”— Intersection Observer'Ä±n nasÄ±l Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± gÃ¶rselleÅŸtiren bir pen](https://codepen.io/michellebarker/pen/xxwLpRG?editors=1010)
